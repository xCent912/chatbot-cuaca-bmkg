<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot AI - Prakiraan Cuaca & Banjir BMKG</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@google/genai@0.3.0"></script>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #1abc9c;
            --warning: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --gray: #95a5a6;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .container {
            display: flex;
            flex-direction: column;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            height: 100vh;
        }
        
        header {
            background-color: var(--primary);
            color: white;
            padding: 20px;
            border-radius: 10px 10px 0 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        header p {
            font-size: 16px;
            opacity: 0.9;
        }
        
        .main-content {
            display: flex;
            flex: 1;
            gap: 20px;
            margin-top: 20px;
        }
        
        .chat-section {
            flex: 3;
            display: flex;
            flex-direction: column;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .weather-section {
            flex: 2;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .chat-header {
            background-color: var(--secondary);
            color: white;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .chat-header i {
            font-size: 24px;
        }
        
        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background-color: #fafafa;
            max-height: 500px;
        }
        
        .message {
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
        }
        
        .message.bot {
            align-items: flex-start;
        }
        
        .message.user {
            align-items: flex-end;
        }
        
        .message-content {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 18px;
            position: relative;
            line-height: 1.5;
            word-wrap: break-word;
        }
        
        .bot .message-content {
            background-color: var(--light);
            color: var(--dark);
            border-bottom-left-radius: 4px;
        }
        
        .user .message-content {
            background-color: var(--secondary);
            color: white;
            border-bottom-right-radius: 4px;
        }
        
        .message-time {
            font-size: 12px;
            color: var(--gray);
            margin-top: 5px;
        }
        
        .chat-input {
            display: flex;
            padding: 20px;
            background-color: white;
            border-top: 1px solid #eee;
        }
        
        .chat-input input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 25px;
            font-size: 16px;
            outline: none;
            transition: border 0.3s;
        }
        
        .chat-input input:focus {
            border-color: var(--secondary);
        }
        
        .chat-input button {
            background-color: var(--accent);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            margin-left: 10px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .chat-input button:hover {
            background-color: #16a085;
        }
        
        .weather-card {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .weather-card h3 {
            color: var(--primary);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--light);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .weather-data {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .location-info {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid var(--secondary);
        }
        
        .location-info h4 {
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        .forecast-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .forecast-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background-color: #f8f9fa;
            border-radius: 8px;
            transition: transform 0.2s;
        }
        
        .forecast-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 3px 5px rgba(0, 0, 0, 0.1);
        }
        
        .forecast-time {
            font-weight: bold;
            color: var(--primary);
        }
        
        .forecast-desc {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--dark);
        }
        
        .forecast-temp {
            font-weight: bold;
            color: var(--secondary);
        }
        
        .weather-icon {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background-color: #e3f2fd;
        }
        
        .flood-warning {
            background-color: #ffeaa7;
            border-left: 4px solid #fdcb6e;
            padding: 15px;
            border-radius: 8px;
        }
        
        .flood-warning h4 {
            color: #d63031;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
        }
        
        .warning-level {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .warning-high {
            background-color: #ff7675;
            color: white;
        }
        
        .warning-medium {
            background-color: #fdcb6e;
            color: #2d3436;
        }
        
        .warning-low {
            background-color: #55efc4;
            color: #2d3436;
        }
        
        .suggested-questions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            padding: 15px 0;
        }
        
        .suggested-question {
            background-color: #e3f2fd;
            color: var(--secondary);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid #bbdefb;
        }
        
        .suggested-question:hover {
            background-color: var(--secondary);
            color: white;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 10px;
            color: var(--gray);
        }
        
        .loading i {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        footer {
            text-align: center;
            padding: 20px;
            color: var(--gray);
            font-size: 14px;
            margin-top: 20px;
            border-top: 1px solid #eee;
        }
        
        .api-status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            margin-left: 10px;
            background-color: #2ecc71;
            color: white;
        }
        
        .api-status.offline {
            background-color: #e74c3c;
        }
        
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .message-content {
                max-width: 90%;
            }
            
            .chat-messages {
                max-height: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-cloud-sun-rain"></i> Chatbot AI - Prakiraan Cuaca & Banjir</h1>
            <p>Dapatkan informasi cuaca terkini dan prakiraan banjir berbasis data BMKG dengan AI Gemini</p>
            <p>Status Gemini AI: <span id="apiStatus" class="api-status">Mengecek...</span></p>
        </header>
        
        <div class="main-content">
            <!-- Bagian Chatbot -->
            <section class="chat-section">
                <div class="chat-header">
                    <i class="fas fa-robot"></i>
                    <h2>Asisten Cuaca AI (Gemini)</h2>
                </div>
                
                <div class="chat-messages" id="chatMessages">
                    <!-- Pesan awal dari bot -->
                    <div class="message bot">
                        <div class="message-content">
                            <strong>Halo! Saya asisten cuaca AI yang didukung oleh Google Gemini.</strong><br><br>
                            Saya dapat membantu Anda dengan:
                            <ul style="margin-top: 8px; margin-left: 20px;">
                                <li>Informasi prakiraan cuaca dari BMKG</li>
                                <li>Analisis potensi banjir berdasarkan data cuaca</li>
                                <li>Rekomendasi tindakan pencegahan banjir</li>
                                <li>Data cuaca untuk wilayah tertentu</li>
                            </ul>
                            <br>
                            <em>Contoh pertanyaan yang bisa diajukan:</em>
                        </div>
                        <div class="message-time">Sekarang</div>
                    </div>
                    
                    <!-- Pertanyaan yang disarankan -->
                    <div class="suggested-questions">
                        <div class="suggested-question" onclick="askQuestion('Bagaimana prakiraan cuaca hari ini di Kemayoran berdasarkan data BMKG?')">
                            <i class="fas fa-sun"></i> Cuaca hari ini
                        </div>
                        <div class="suggested-question" onclick="askQuestion('Analisis potensi banjir di Kemayoran berdasarkan data curah hujan BMKG')">
                            <i class="fas fa-water"></i> Analisis banjir
                        </div>
                        <div class="suggested-question" onclick="askQuestion('Rekomendasi antisipasi banjir untuk wilayah Jakarta Pusat')">
                            <i class="fas fa-shield-alt"></i> Antisipasi banjir
                        </div>
                        <div class="suggested-question" onclick="askQuestion('Jelaskan data cuaca dari BMKG untuk 3 hari ke depan')">
                            <i class="fas fa-calendar-alt"></i> Prakiraan 3 hari
                        </div>
                    </div>
                </div>
                
                <div class="loading" id="loading">
                    <i class="fas fa-spinner"></i> Gemini AI sedang menganalisis...
                </div>
                
                <div class="chat-input">
                    <input type="text" id="userInput" placeholder="Tanya tentang cuaca atau banjir..." onkeypress="handleKeyPress(event)">
                    <button onclick="sendMessage()">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </section>
            
            <!-- Bagian Data Cuaca -->
            <section class="weather-section">
                <div class="weather-card">
                    <h3><i class="fas fa-map-marker-alt"></i> Data Cuaca BMKG</h3>
                    <div class="weather-data">
                        <div class="location-info">
                            <h4 id="locationName">Kemayoran, Jakarta Pusat</h4>
                            <p id="locationDetails">Memuat data lokasi...</p>
                            <p>Data diperbarui: <span id="updateTime">-</span></p>
                            <button onclick="fetchBMKGData()" style="margin-top: 10px; padding: 8px 15px; background-color: var(--secondary); color: white; border: none; border-radius: 4px; cursor: pointer;">
                                <i class="fas fa-sync-alt"></i> Muat Ulang Data
                            </button>
                        </div>
                        
                        <div id="weatherForecast">
                            <p>Memuat data cuaca dari BMKG...</p>
                        </div>
                    </div>
                </div>
                
                <div class="weather-card">
                    <h3><i class="fas fa-exclamation-triangle"></i> Analisis Potensi Banjir</h3>
                    <div class="flood-warning">
                        <h4><i class="fas fa-water"></i> Status Banjir</h4>
                        <div id="floodAnalysis">
                            <p>Analisis berdasarkan data cuaca terkini dari BMKG:</p>
                            <p>Menunggu data cuaca...</p>
                        </div>
                    </div>
                    
                    <div style="margin-top: 15px;">
                        <h4><i class="fas fa-lightbulb"></i> Tips dari AI Gemini</h4>
                        <div id="aiTips">
                            <p>Tips akan ditampilkan setelah analisis AI...</p>
                        </div>
                    </div>
                </div>
            </section>
        </div>
        
        <footer>
            <p>Dibangun dengan integrasi data dari BMKG dan Google Gemini AI</p>
            <p>Data cuaca diperbarui secara otomatis | © 2025 Chatbot Cuaca AI</p>
        </footer>
    </div>

    <script>
        // Konfigurasi Gemini AI
        const GEMINI_API_KEY = "AIzaSyCxqfa5mhhctEqV3Z3RofrZcJRzGEZIw7g";
        
        // Data cuaca dari BMKG
        let currentWeatherData = null;
        let currentLocation = "31.71.03.1001"; // Kode wilayah Kemayoran

        // Inisialisasi Gemini AI
        let geminiAI = null;
        
        // Fungsi untuk menginisialisasi Gemini AI
        async function initializeGemini() {
            try {
                geminiAI = new GoogleGenAI({ apiKey: GEMINI_API_KEY });
                document.getElementById('apiStatus').textContent = "Online";
                document.getElementById('apiStatus').classList.remove('offline');
                console.log("Gemini AI berhasil diinisialisasi");
                return true;
            } catch (error) {
                console.error("Gagal menginisialisasi Gemini AI:", error);
                document.getElementById('apiStatus').textContent = "Offline";
                document.getElementById('apiStatus').classList.add('offline');
                return false;
            }
        }

        // Fungsi untuk mendapatkan waktu sekarang
        function getCurrentTime() {
            const now = new Date();
            return now.toLocaleTimeString('id-ID', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
        }

        // Fungsi untuk mengirim pesan
        async function sendMessage() {
            const userInput = document.getElementById('userInput');
            const message = userInput.value.trim();
            
            if (message === '') return;
            
            // Tampilkan pesan pengguna
            addMessage(message, 'user');
            
            // Kosongkan input
            userInput.value = '';
            
            // Tampilkan loading
            document.getElementById('loading').style.display = 'block';
            
            try {
                // Dapatkan respons dari Gemini AI
                const response = await getGeminiResponse(message);
                addMessage(response, 'bot');
                
                // Perbarui tips AI jika relevan
                if (message.toLowerCase().includes('banjir') || message.toLowerCase().includes('rekomendasi')) {
                    updateAITips(response);
                }
            } catch (error) {
                console.error("Error getting AI response:", error);
                addMessage("Maaf, terjadi kesalahan saat memproses pertanyaan Anda. Silakan coba lagi.", 'bot');
            } finally {
                // Sembunyikan loading
                document.getElementById('loading').style.display = 'none';
            }
        }

        // Fungsi untuk mendapatkan respons dari Gemini AI
        async function getGeminiResponse(userMessage) {
            if (!geminiAI) {
                const initialized = await initializeGemini();
                if (!initialized) {
                    return "Gemini AI belum dapat diakses. Silakan refresh halaman atau coba lagi nanti.";
                }
            }
            
            try {
                // Siapkan konteks dengan data cuaca terkini
                const weatherContext = currentWeatherData ? 
                    `Data cuaca terkini dari BMKG: ${JSON.stringify(currentWeatherData.lokasi)}. ` +
                    `Prakiraan cuaca: ${JSON.stringify(currentWeatherData.data[0].cuaca[0].slice(0, 3))}. ` : 
                    "Data cuaca sedang dimuat.";
                
                const prompt = `Anda adalah asisten ahli cuaca dan manajemen banjir di Indonesia. 
                Gunakan data BMKG yang tersedia untuk memberikan jawaban yang akurat.
                
                ${weatherContext}
                
                Pertanyaan pengguna: ${userMessage}
                
                Berikan jawaban yang:
                1. Informatif dan berdasarkan data BMKG jika tersedia
                2. Sertakan analisis potensi banjir jika relevan
                3. Berikan rekomendasi praktis jika diperlukan
                4. Gunakan bahasa Indonesia yang mudah dipahami
                5. Format jawaban dengan baik menggunakan HTML sederhana untuk pemisah paragraf`;
                
                const response = await geminiAI.models.generateContent({
                    model: "gemini-2.0-flash-exp",
                    contents: prompt,
                    generationConfig: {
                        temperature: 0.7,
                        maxOutputTokens: 1000,
                    }
                });
                
                return response.text || "Maaf, saya tidak bisa memberikan jawaban saat ini.";
                
            } catch (error) {
                console.error("Error calling Gemini API:", error);
                return "Maaf, terjadi kesalahan saat menghubungi AI. Berikut informasi berdasarkan data yang tersedia: " + 
                       getFallbackResponse(userMessage);
            }
        }

        // Fungsi fallback jika Gemini tidak tersedia
        function getFallbackResponse(userMessage) {
            const lowerMessage = userMessage.toLowerCase();
            
            if (lowerMessage.includes('cuaca') && lowerMessage.includes('hari ini')) {
                return "Berdasarkan data BMKG, cuaca di Kemayoran hari ini bervariasi antara berawan dan hujan ringan dengan suhu 25-30°C.";
            } else if (lowerMessage.includes('banjir')) {
                return "Berdasarkan data curah hujan BMKG, potensi banjir di Kemayoran saat ini dalam tingkat waspada. Disarankan untuk memantau perkembangan cuaca.";
            } else if (lowerMessage.includes('rekomendasi')) {
                return "Rekomendasi antisipasi banjir: 1) Pantau informasi cuaca BMKG, 2) Siapkan perlengkapan darurat, 3) Hindari daerah rendah saat hujan deras.";
            } else {
                return "Saya dapat membantu dengan informasi cuaca dan analisis banjir berdasarkan data BMKG. Silakan tanyakan tentang prakiraan cuaca atau potensi banjir.";
            }
        }

        // Fungsi untuk menangani tombol enter
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        // Fungsi untuk pertanyaan yang disarankan
        function askQuestion(question) {
            document.getElementById('userInput').value = question;
            sendMessage();
        }

        // Fungsi untuk menambahkan pesan ke chat
        function addMessage(content, sender) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            messageDiv.innerHTML = `
                <div class="message-content">${content}</div>
                <div class="message-time">${getCurrentTime()}</div>
            `;
            
            chatMessages.appendChild(messageDiv);
            
            // Scroll ke bawah
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Fungsi untuk mengambil data BMKG
        async function fetchBMKGData() {
            try {
                const response = await fetch(`https://api.bmkg.go.id/publik/prakiraan-cuaca?adm4=${currentLocation}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                currentWeatherData = data;
                
                // Tampilkan data
                displayWeatherData(data);
                updateFloodAnalysis();
                
                // Update waktu pembaruan
                document.getElementById('updateTime').textContent = new Date().toLocaleString('id-ID');
                
                console.log("Data BMKG berhasil dimuat:", data);
                
            } catch (error) {
                console.error("Error fetching BMKG data:", error);
                
                // Gunakan data contoh jika API gagal
                useSampleData();
                
                document.getElementById('weatherForecast').innerHTML = 
                    `<p style="color: #e74c3c;">Gagal memuat data real-time. Menampilkan data contoh.</p>`;
            }
        }

        // Fungsi untuk data contoh
        function useSampleData() {
            currentWeatherData = {
                "lokasi": {
                    "adm1": "31",
                    "adm2": "31.71",
                    "adm3": "31.71.03",
                    "adm4": "31.71.03.1001",
                    "provinsi": "DKI Jakarta",
                    "kotkab": "Kota Adm. Jakarta Pusat",
                    "kecamatan": "Kemayoran",
                    "desa": "Kemayoran",
                    "lon": 106.8453837867,
                    "lat": -6.1647214778,
                    "timezone": "Asia/Jakarta"
                },
                "data": [
                    {
                        "lokasi": {
                            "adm1": "31",
                            "adm2": "31.71",
                            "adm3": "31.71.03",
                            "adm4": "31.71.03.1001",
                            "provinsi": "DKI Jakarta",
                            "kotkab": "Kota Adm. Jakarta Pusat",
                            "kecamatan": "Kemayoran",
                            "desa": "Kemayoran",
                            "lon": 106.8453837867,
                            "lat": -6.1647214778,
                            "timezone": "+0700",
                            "type": "adm4"
                        },
                        "cuaca": [
                            [
                                {
                                    "datetime": "2025-12-14T01:00:00",
                                    "t": 26,
                                    "weather_desc": "Berawan",
                                    "tp": 0,
                                    "ws": 12.5,
                                    "hu": 82
                                },
                                {
                                    "datetime": "2025-12-14T04:00:00",
                                    "t": 25,
                                    "weather_desc": "Hujan Ringan",
                                    "tp": 1.6,
                                    "ws": 10.2,
                                    "hu": 84
                                },
                                {
                                    "datetime": "2025-12-14T07:00:00",
                                    "t": 26,
                                    "weather_desc": "Hujan Ringan",
                                    "tp": 1.7,
                                    "ws": 11.6,
                                    "hu": 84
                                },
                                {
                                    "datetime": "2025-12-14T10:00:00",
                                    "t": 28,
                                    "weather_desc": "Berawan",
                                    "tp": 0.1,
                                    "ws": 11.6,
                                    "hu": 71
                                }
                            ]
                        ]
                    }
                ]
            };
            
            displayWeatherData(currentWeatherData);
            updateFloodAnalysis();
        }

        // Fungsi untuk menampilkan data cuaca
        function displayWeatherData(data) {
            const forecastContainer = document.getElementById('weatherForecast');
            const locationInfo = document.getElementById('locationDetails');
            
            // Update informasi lokasi
            locationInfo.innerHTML = `
                <strong>Provinsi:</strong> ${data.lokasi.provinsi}<br>
                <strong>Kota/Kab:</strong> ${data.lokasi.kotkab}<br>
                <strong>Kecamatan:</strong> ${data.lokasi.kecamatan}<br>
                <strong>Koordinat:</strong> ${data.lokasi.lon.toFixed(4)}°E, ${data.lokasi.lat.toFixed(4)}°S
            `;
            
            document.getElementById('locationName').textContent = `${data.lokasi.kecamatan}, ${data.lokasi.kotkab}`;
            
            // Tampilkan prakiraan cuaca
            const forecasts = data.data[0].cuaca[0];
            
            let html = '<div class="forecast-container">';
            
            forecasts.forEach((forecast, index) => {
                if (index < 6) { // Tampilkan 6 data pertama
                    const time = new Date(forecast.datetime).toLocaleTimeString('id-ID', {
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    
                    const weatherIcon = getWeatherIcon(forecast.weather_desc);
                    const rainfall = forecast.tp > 0 ? `${forecast.tp} mm` : '-';
                    
                    html += `
                        <div class="forecast-item">
                            <div class="forecast-time">${time}</div>
                            <div class="forecast-desc">
                                <div class="weather-icon">
                                    <i class="${weatherIcon}"></i>
                                </div>
                                ${forecast.weather_desc}
                            </div>
                            <div class="forecast-temp">${forecast.t}°C</div>
                        </div>
                    `;
                }
            });
            
            html += '</div>';
            forecastContainer.innerHTML = html;
        }

        // Fungsi untuk update analisis banjir
        function updateFloodAnalysis() {
            if (!currentWeatherData) return;
            
            const floodAnalysis = document.getElementById('floodAnalysis');
            const forecasts = currentWeatherData.data[0].cuaca[0];
            
            // Hitung total curah hujan
            let totalRainfall = 0;
            let rainHours = 0;
            
            forecasts.forEach(forecast => {
                if (forecast.tp > 0) {
                    totalRainfall += forecast.tp;
                    rainHours++;
                }
            });
            
            // Tentukan tingkat risiko
            let riskLevel, riskColor, riskText, recommendation;
            
            if (totalRainfall > 10) {
                riskLevel = 'high';
                riskColor = 'warning-high';
                riskText = 'TINGGI';
                recommendation = 'Waspada banjir! Hindari daerah rendah dan siapkan evakuasi.';
            } else if (totalRainfall > 5) {
                riskLevel = 'medium';
                riskColor = 'warning-medium';
                riskText = 'SEDANG';
                recommendation = 'Potensi genangan air. Pantau saluran air dan siapkan tindakan pencegahan.';
            } else {
                riskLevel = 'low';
                riskColor = 'warning-low';
                riskText = 'RENDAH';
                recommendation = 'Risiko banjir rendah. Pantau perkembangan cuaca.';
            }
            
            floodAnalysis.innerHTML = `
                <p><strong>Tingkat risiko:</strong> <span class="warning-level ${riskColor}">${riskText}</span></p>
                <p><strong>Curah hujan total:</strong> ${totalRainfall.toFixed(1)} mm</p>
                <p><strong>Durasi hujan:</strong> ${rainHours} jam</p>
                <p><strong>Rekomendasi:</strong> ${recommendation}</p>
            `;
        }

        // Fungsi untuk update tips AI
        function updateAITips(aiResponse) {
            const aiTips = document.getElementById('aiTips');
            
            // Ekstrak tips dari respons AI
            const tipsMatch = aiResponse.match(/rekomendasi.*?(?=<|$)/i);
            
            if (tipsMatch) {
                aiTips.innerHTML = `<p>${tipsMatch[0]}</p>`;
            } else {
                aiTips.innerHTML = `<p>Berdasarkan analisis AI, pantau informasi cuaca terkini dari BMKG dan siapkan rencana darurat.</p>`;
            }
        }

        // Fungsi untuk mendapatkan ikon cuaca
        function getWeatherIcon(weatherDesc) {
            const desc = weatherDesc.toLowerCase();
            
            if (desc.includes('cerah')) {
                return 'fas fa-sun';
            } else if (desc.includes('berawan')) {
                return 'fas fa-cloud';
            } else if (desc.includes('hujan')) {
                return desc.includes('ringan') ? 'fas fa-cloud-rain' : 'fas fa-cloud-showers-heavy';
            } else if (desc.includes('mendung')) {
                return 'fas fa-cloud';
            } else {
                return 'fas fa-cloud-sun';
            }
        }

        // Inisialisasi saat halaman dimuat
        document.addEventListener('DOMContentLoaded', async function() {
            // Inisialisasi Gemini AI
            await initializeGemini();
            
            // Muat data cuaca
            fetchBMKGData();
            
            // Fokus ke input chat
            document.getElementById('userInput').focus();
            
            // Update waktu
            document.getElementById('updateTime').textContent = new Date().toLocaleString('id-ID');
            
            // Tambahkan pesan selamat datang dari AI
            setTimeout(() => {
                addMessage("Selamat datang! Saya siap membantu Anda dengan informasi cuaca dan analisis banjir menggunakan data real-time dari BMKG. Silakan ajukan pertanyaan Anda.", 'bot');
            }, 1000);
        });
    </script>
</body>
</html>

